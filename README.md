# OSV to Slack Vulnerability Notifier

This is a standalone application designed to monitor an `npm` project's dependencies for vulnerabilities. It periodically checks a `package.json` file for any new or updated packages, scans them using the Open Source Vulnerabilities (OSV) database, and sends a detailed report to a specified user via a Slack Direct Message.

## Architecture

The application is built with Node.js and TypeScript, and it follows a modular design for maintainability and extensibility.

- **Entry Point (`scanner-runner.ts`):** This is the main script that starts the application. Its primary responsibilities are to load environment variables from the `.env.local` file and to initiate the polling service.
- **Services:** The core logic is organized into several modules within the `services/` directory:
  - **`scanner.ts`:** The main orchestrator. It contains the polling mechanism that watches `package.json` for changes, compares dependencies against a lock file to get exact versions, and coordinates the scanning and notification process.
  - **`osv.ts`:** A dedicated module for communicating with the OSV API. It takes a package name and version and returns any found vulnerabilities.
  - **`slack.ts`:** A module responsible for formatting the final report and sending it as a Direct Message via the Slack API.

## Setup and Installation

Follow these steps to set up and run the application.

### Prerequisites

- Node.js (v18 or later)
- npm
- A Slack account and workspace

### 1\. Clone the Repository

Clone this private repository to your local machine.

```bash
git clone <your-private-repo-url>
cd osv-slack-scanner
```

### 2\. Install Dependencies

Install the required npm packages.

```bash
npm install
```

### 3\. Configure Environment Variables

The application must be configured using environment variables. Create a file named `.env.local` in the root of the project and add the following content.

```ini
# Get this from your Slack App's "OAuth & Permissions" page
SLACK_BOT_TOKEN="xoxb-your-slack-bot-token"

# Get this by copying the Member ID from a user's Slack profile
SLACK_USER_ID="U0..."

# The path to the package.json file to monitor
PACKAGE_JSON_PATH="./package.json"
```

### 4\. Run the Application

Start the application in development mode. It will run the Next.js server and the background scanner script simultaneously.

```bash
npm run dev
```

The application is now running. It will scan all dependencies on startup and then poll the `package.json` file for any changes.

## How It Works

The application works by keeping an in-memory state of the dependencies listed in `package.json`. Every 15 seconds, it re-reads the file and compares it to the stored state. If a new package is added or an existing package's version is changed, it triggers the scanner.

To ensure accuracy, the scanner reads the **exact** installed version from `package-lock.json` and sends this version to the OSV API for analysis. Once the results are returned, a report is generated and sent to the configured Slack user.

## Slack Notification Examples

Here are examples of the Slack notifications generated by the application.

### Vulnerable Package Report

```
OSV Scan Report
Timestamp: 8/18/2025, 2:30 PM

Package: lodash@4.17.20
Vulnerabilities Found:
  ID: GHSA-29mw-wpgm-hmr9
  Summary: Regular Expression Denial of Service (ReDoS) in lodash
  ---
  ID: GHSA-35jh-r3h4-6jhm
  Summary: Command Injection in lodash
  ---
```

### Clean Package Report

```
OSV Scan Report
Timestamp: 8/18/2025, 2:32 PM

Package: react@18.3.1
Result: No vulnerabilities were found.
```
